@model Shoppu.Domain.ViewModels.NavbarMenuDataViewModel
@using Shoppu.Domain.Entities


@{
    async Task generateMenu(string gender)
    {
        <div 
        class="dropdown is-hoverable navbar-item is-hidden-mobile is-hidden-tablet-only is-flex p-0 has-products-main-menu navbar-menu-item">
            <div class="menu-item-box">
                <div class="is-flex is-align-items-center link-wrapper">
                    <a class="navbar-item text px-4" aria-haspopup="true" aria-controls="@(gender)Menu" asp-area=""
                        asp-page="/Shop/Browse" asp-route-gender="@gender" asp-route-query="all"
                        asp-route-categoryUrl="clothes">
                            <span>@gender</span>
                    </a>
                </div>
            </div>
            <div id="@(gender)Menu" role="menu" class="dropdown-menu products-main-menu">
                <div class="dropdown-content pb-6">
                    <div class="container columns mx-auto pt-3">
                        @foreach (var mainCategory in Model.MainCategoriesWithTheirSubcategories)
                        {
                            <div class="column is-3 mx-3">
                                <a class="is-6 is-uppercase is-grey" asp-area="" asp-page="/Shop/Browse" asp-route-gender="@gender"
                            asp-route-categoryUrl="@mainCategory.UrlName">@mainCategory.Name</a>
                                <div class="is-flex is-flex-direction-column mt-4">
                                    @foreach (var subcategory in @mainCategory.SubCategories)
                                    {
                                        <div class="my-1">
                                            <a class="is-text nav-menu-sublink" asp-area="" asp-page="/Shop/Browse"
                                                asp-route-gender="@gender"
                                                asp-route-query="@mainCategory.UrlName"
                                                asp-route-categoryUrl="@subcategory.UrlName">
                                                    @subcategory.Name
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>

            </div>
        </div>

    };

    async Task generateTabletMenu(string gender)
    {
            <li>
                <a id="@(gender)Menu" class="navbar-item is-flex is-justify-content-space-between px-4 side-menu-item open-submenu">
                    <span class="link-text">
                        @gender                      
                    </span>
                    <span class="link-icon">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                    </span>
                </a>
                <div class="pl-4 submenu">
                    <ul>
                        @foreach (var mainCategory in Model.MainCategoriesWithTheirSubcategories)
                        {
                            <li>
                                <p id="@gender@mainCategory.Id" class="navbar-item is-flex is-justify-content-space-between px-4 side-menu-item open-submenu">
                                    <span class="link-text">
                                        @mainCategory.Name
                                    </span>
                                    <span class="link-icon">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </span>
                                </p>
                                <div class="pl-4 submenu">
                                    <ul>
                                        @foreach (var subcategory in mainCategory.SubCategories)
                                        {
                                            <li>
                                                <a class="navbar-item px-4 category-link" asp-area="" asp-page="/Shop/Browse" 
                                                    asp-route-gender="@gender" asp-route-categoryUrl="@subcategory.UrlName">
                                                    <span class="link-text">@subcategory.Name</span>
                                                </a>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            </li>
    };
}

@{
    await generateMenu("woman");
    await generateMenu("man");
	@* div that takes empty space on the right side of menu - to disable hover events for flex-grow-1 dropdown items *@
        <div class="is-hidden-mobile-only is-hidden-tablet-only navbar-menu-item"></div>
    @*  *@
}

<aside class="is-hidden-desktop navbar-menu-tablet pb-6">
        <ul>
            <a class="navbar-item is-flex is-justify-content-space-between px-4 side-menu-item" 
                asp-area="" asp-page="/Shop/Browse">
                    <span class="link-text">
                        Latest
                    </span>
                    <span class="link-icon">
                        <i class="fa fa-chevron-right" aria-hidden="true"></i>
                    </span>
                </a>
    @{
        await generateTabletMenu("woman");
        await generateTabletMenu("man");
    }
        </ul>
</aside>
@* TODO: MOBILE, TABLET -> NO DISPLAY *@
@* TODO: REDO DISPLAY OF NAVBAR MENU *@

<script>
    document.addEventListener('DOMContentLoaded', () => {

        var $openSubmenuButtons = $('.open-submenu');

        $openSubmenuButtons.each((index, button) => {
            $(button).on('click', () => {
                $(button).toggleClass('is-toggled');
                $(button).children('span.link-icon')
                    .children('i').toggleClass('fa-plus').toggleClass('fa-minus')
            })
        })


    })
</script>