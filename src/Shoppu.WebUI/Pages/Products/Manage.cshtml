@page "{categoryUrl}"
@model Shoppu.WebUI.Pages.Products.ManageModel

@{
  var location = new Uri($"{Request.Scheme}://{Request.Host}");
  var url = location.AbsoluteUri;
}

<div class="columns">
  <div class="column is-12-mobile is-12-tablet is-3-desktop is-2-widescreen pr-0 side-menu">
    @await Component.InvokeAsync("BrowseSideMenu", new {categoryUrl = Model.CategoryUrl, appliedManageFilters =
    Model.AppliedFilters})
  </div>
  <div class="column is-12-mobile is-12 is-9-desktop is-10-widescreen pl-0 pr-5">

    @* @foreach (var product in Model.Products)
      {
      <div class="columns has-background-white-ter">
      <div class="column is-3">@product.Name</div>
      <div class="column is-5">@product.Description</div>
      <div class="column is-1">@product.Price$</div>
      <div class="column is-2"><a class="button" asp-page="CreateVariant" asp-route-id="@product.Id">Create variant</a>
      </div>
      </div>
      } *@
    <table class="table is-fullwidth is-bordered has-text-centered manage-product-table">
      <thead>
        <tr>
          <th class="has-text-centered">Gender</th>
          <th class="has-text-centered">Name</th>
          <th class="has-text-centered"></th>
          <th class="has-text-centered"><abbr title="Product type">Type</abbr></th>
          <th class="has-text-centered">Price($)</th>
          <th class="has-text-centered" style="width: 5%"><a class="button is-success" asp-page="Create">Add new</a>
          </th>

        </tr>
      </thead>
      <tbody>
        @if (Model.Products != null)
        {
          @foreach (var product in Model.Products)
          {
            <tr class="product-row">
              <td>@product.Gender</td>
              <td>@product.Name</td>
              <td></td>
              <td>@product.ProductCategory.Name</td>
              <td>@product.Price.ToString("0.00$")</td>

              <td><a class="button" asp-page="CreateVariant" asp-route-id="@product.Id">Create variant</a></td>
            </tr>
            @if (product.Variants.Count() > 0)
            {
              <tr class="has-background-success-light has-text-centered">
                <th>Main image</th>
                <th>
                  @if (product.Variants.Count > 0)
                  {
                    <form method="post" asp-page-handler="ChangeProductVisibility">
                      <button type="submit" class="button is-warning">Make all accessible</button>
                    </form>
                  }
                </th>
                <th></th>
                <th>Color</th>
                <th>Size: Quantity</th>
                <th>test</th>
              </tr>
              @foreach (var variant in product.Variants)
              {
                <tr class=" has-text-centered">
                  <td>
                    <p>@variant.Name</p>
                    <img width="100" src="@url\@variant.Images[0].ImageSource" />
                  </td>
                  <td>
                    @{
                      if (variant.IsAccessible)
                      {
                        <button class="button is-success">Active</button>
                      }
                      else
                      {
                        if (variant.Sizes.Count > 0)
                        {
                          <form method="post" asp-page-handler="ChangeVariantVisibility">
                            <input type="hidden" name="variantId" asp-for="@variant.Id" />
                            <button type="submit" class="button is-warning">Make accessible</button>
                          </form>
                        }
                        else
                        {
                          <button disabled class="button is-danger">Sizes not set</button>

                        }
                      }
                    }
                  </td>
                  <td></td>
                  <td>@variant.Variant.Name</td>
                  <td>
                    @foreach (var size in variant.Sizes)
                    {
                      <p><span>@size.Size.Name:</span><span>
                          @size.Quantity</span></p>
                    }
                  </td>

                  <td class="">
                    <a class="button is-info" asp-page="CreateVariantSizes" asp-route-productId="@product.Id"
              asp-route-variantId="@variant.Id">Edit variant</a>
                    <a class="button is-info mt-1" asp-page="CreateVariantSizes" asp-route-productId="@product.Id"
              asp-route-variantId="@variant.Id">Specify sizes</a>
                  </td>
                </tr>
              }
            }
            else
            {
              <tr class="has-background-grey-lighter">
                <td colspan="5">Product has no variants</td>
              </tr>
            }
          }
        }

      </tbody>
    </table>
  </div>
</div>